/*
 * Copyright (c) Huawei Technologies Co., Ltd. 2020-2020. All rights reserved.
 * Description: als para table avago source file
 * Author: linjianpeng <linjianpeng1@huawei.com>
 * Create: 2020-05-25
 */

#include <linux/module.h>
#include <linux/err.h>
#include <linux/types.h>
#include <linux/of.h>
#include <linux/of_gpio.h>
#include <linux/rtc.h>
#include <linux/of_device.h>
#include <linux/slab.h>
#include "contexthub_route.h"
#include "contexthub_boot.h"
#include "contexthub_recovery.h"
#include "protocol.h"
#include "sensor_config.h"
#include "sensor_detect.h"
#include "sensor_sysfs.h"
#include "als_tp_color.h"
#include "als_channel.h"
#include "als_para_table_avago.h"
#include <securec.h>

/*
 * Although the GRAY and Black TP's RGB ink is same ,
 * but some product may has both the GRAY
 * and Black TP,so must set the als para for  GRAY and Black TP
 * Although the CAFE_2 and BROWN TP's RGB ink is same ,
 * but some product may has both the CAFE_2
 * and BROWN TP,so must set the als para for  CAFE_2 and BROWN TP
 */
apds9251_als_para_table apds_als_para_diff_tp_color_table[] = {
	{ OTHER, OTHER, DEFAULT_TPLCD, OTHER,
	  { 30165, -1970, 1572, 1377, 1056, 1019, 728, 1019, 415, 171, 163,
	    0, 0, 0, 0, 0, 0, 2000, 1000, 1, 24 }
	},
	{ ALPS, V1, DEFAULT_TPLCD, GOLD,
	  { 30165, -1970, 1572, 1377, 1056, 1019, 728, 1019, 415, 171, 163,
	     5800, 7806, 2138, 220, 3705, 9149, 5000, 200, 1, 24 }
	},
	{ ALPS, V1, DEFAULT_TPLCD, BLACK,
	  { 22462, -887, 1285, 1142, 967, 1010, 806, 1010, 400, 168, 162,
	    6890, 9198, 2932, 260, 3283, 8671, 5000, 200, 1, 29 }
	},
	{ ALPS, V1, DEFAULT_TPLCD, GRAY,
	  { 22462, -887, 1285, 1142, 967, 1010, 806, 1010, 400, 168, 162,
	    6890, 9198, 2932, 260, 3283, 8671, 5000, 200, 1, 29 }
	},
	{ ALPS, V1, DEFAULT_TPLCD, WHITE,
	  { 8136, 1274, 364, 328, 299, 1000, 1062, 1000, 294, 123, 121,
	    18316, 28410, 12294, 752, 2872, 6735, 5000, 200, 1, 42 }
	},
	{ ALPS, V3, DEFAULT_TPLCD, GOLD,
	  { 20507, -451, 2091, 1942, 1671, 1002, 861, 1002, 350, 144, 138,
	    4956, 6660, 2042, 172, 3246, 8932, 5000, 200, 1, 26 }
	},
	{ ALPS, V3, DEFAULT_TPLCD, WHITE,
	  { 9728, 926, 520, 474, 426, 1001, 1000, 1001, 337, 138, 135,
	    15040, 22156, 10120, 576, 2872, 6735, 5000, 200, 1, 40 }
	},
	{ ALPS, V3, DEFAULT_TPLCD, BLACK,
	  { 22462, -887, 1440, 1234, 967, 1010, 806, 1010, 400, 168, 162,
	    6890, 9198, 2932, 260, 3283, 8671, 5000, 200, 1, 29 }
	},
	{ ALPS, V3, DEFAULT_TPLCD, GRAY,
	  { 22462, -887, 1440, 1234, 967, 1010, 806, 1010, 400, 168, 162,
	    6890, 9198, 2932, 260, 3283, 8671, 5000, 200, 1, 29 }
	},
	{ ALPS, V3_D, DEFAULT_TPLCD, GOLD,
	  { 8371, 1186, 1488, 1400, 1317, 1000, 967, 1000, 234, 93, 91,
	    4758, 7618, 3362, 174, 3148, 7100, 5000, 200, 1, 45 }
	},
	{ ALPS, V3, DEFAULT_TPLCD, BROWN,
	  { 24058, -470, 1451, 1336, 1159, 1004, 789, 1004, 244, 100, 98,
	    7846, 8724, 2828, 236, 3605, 4203, 5000, 150, 1, 26 }
	},
	{ ALPS, V3_D, DEFAULT_TPLCD, BLACK,
	  { 22462, -887, 1440, 1234, 967, 1010, 806, 1010, 400, 168, 162,
	    6890, 9198, 2932, 260, 3283, 8671, 5000, 200, 1, 29 }
	},
	{ ALPS, V3_D, DEFAULT_TPLCD, GRAY,
	  { 22462, -887, 1440, 1234, 967, 1010, 806, 1010, 400, 168, 162,
	    6890, 9198, 2932, 260, 3283, 8671, 5000, 200, 1, 29 }
	},
	{ ALPS, V3_D, DEFAULT_TPLCD, BROWN,
	  { 24058, -470, 1451, 1336, 1159, 1004, 789, 1004, 244, 100, 98,
	    7846, 8724, 2828, 236, 3605, 4203, 5000, 150, 1, 26 }
	},
	{ ALPS, VN1, DEFAULT_TPLCD, GOLD,
	  { 8371, 1186, 1488, 1400, 1317, 1000, 967, 1000, 234, 93, 91,
	    4758, 7618, 3362, 174, 3148, 7100, 5000, 200, 1, 45 }
	},
	{ ALPS, VN1, DEFAULT_TPLCD, BROWN,
	  { 16522, 247, 1091, 1117, 1084, 1001, 735, 1001, 548, 194, 189,
	    7575, 10491, 3697, 338, 3179, 8311, 5000, 200, 1, 36 }
	},
	{ ALPS, VN1, DEFAULT_TPLCD, BLACK,
	  { 14693, 285, 1618, 1608, 1540, 1000, 781, 1000, 1004, 353, 346,
	    5301, 8663, 2841, 292, 3571, 8160, 5000, 200, 1, 38 }
	},
	{ ALPS, VN1, DEFAULT_TPLCD, BLACK2,
	  { 14693, 285, 1618, 1608, 1540, 1000, 781, 1000, 1004, 353, 346,
	    5301, 8663, 2841, 292, 3571, 8160, 5000, 200, 1, 38 }
	},
	{ ALPS, VN1, DEFAULT_TPLCD, GRAY,
	  { 14693, 285, 1618, 1608, 1540, 1000, 781, 1000, 1004, 353, 346,
	    5301, 8663, 2841, 292, 3571, 8160, 5000, 200, 1, 38 }
	},
	{ BLANC, V3, DEFAULT_TPLCD, GOLD,
	  { 7841, 1321, 950, 895, 848, 1000, 978, 1000, 218, 87, 83,
	    7628, 12020, 5516, 252, 3171, 6991, 5000, 200, 1, 46 }
	},
	{ BLANC, V3, DEFAULT_TPLCD, BROWN,
	  { 11115, 712, 1239, 1075, 966, 1001, 969, 1001, 354, 143, 140,
	    7520, 9700, 4386, 268, 3171, 6991, 4000, 300, 1, 38 }
	},
	{ BLANC, V3, DEFAULT_TPLCD, PINK_GOLD,
	  { 12036, 1206, 2909, 2633, 2198, 1000, 936, 1000, 224, 89, 86,
	    3974, 4188, 1908, 116, 3171, 6991, 4000, 300, 1, 32 }
	},
	{ BLANC, V3, DEFAULT_TPLCD, BLUE,
	  { 20835, -1610, 3901, 1516, 843, 1010, 1182, 1010, 1110, 491, 447,
	    3750, 3388, 1552, 490, 3171, 6991, 4000, 300, 1, 25 }
	},
	{ BLANC, VN1, DEFAULT_TPLCD, BLACK,
	  { 19111, -232, 1702, 1656, 1567, 1092, 773, 1092, 1075, 370, 358,
	    4615, 7075, 2202, 248, 3800, 7417, 4000, 300, 1, 25 }
	},
	{ BLANC, VN1, DEFAULT_TPLCD, BLACK2,
	  { 19111, -232, 1702, 1656, 1567, 1092, 773, 1092, 1075, 370, 358,
	    4615, 7075, 2202, 248, 3800, 7417, 4000, 300, 1, 25 }
	},
	{ BLANC, VN1, DEFAULT_TPLCD, GRAY,
	  { 19111, -232, 1702, 1656, 1567, 1092, 773, 1092, 1075, 370, 358,
	    4615, 7075, 2202, 248, 3800, 7417, 4000, 300, 1, 25 }
	},
	{ BLANC, VN1, DEFAULT_TPLCD, BROWN,
	  { 12422, 940, 1229, 1199, 1139, 1000, 882, 1000, 968, 352, 330,
	    6600, 9194, 3186, 348, 3304, 6936, 4000, 300, 1, 35 }
	},
	{ BLANC, VN1, DEFAULT_TPLCD, BLUE,
	  { 19408, 119, 4926, 5066, 4606, 1001, 828, 1001, 1327, 465, 450,
	    1753, 2487, 702, 98, 3304, 6936, 4000, 300, 1, 26 }
	},
	{ BLANC, VN1, DEFAULT_TPLCD, PINK_GOLD,
	  { 12036, 1206, 2909, 2633, 2198, 1000, 936, 1000, 224, 89, 86,
	    3974, 4188, 1908, 116, 3171, 6991, 4000, 300, 1, 32 }
	},

	{ BKL, V3, DEFAULT_TPLCD, BLACK,
	  { 4399, 1650, 9764, 7384, 7357, 992, 1082, 851, 3098, 1954, 797,
	    601, 914, 521,  101, 3171, 6991, 30000, 0, 0, 32 }
	},
	{ BKL, V3, DEFAULT_TPLCD, WHITE,
	  { 7196, 1616, 890, 874, 928, 957, 988, 901, 529, 300, 116,
	    7714, 12430, 4190, 314, 3171, 6991, 30000, 0, 0, 32 }
	},
	{ BKL, V3, DEFAULT_TPLCD, BLUE,
	  { 348, 1418, 3674, 2449, 3144, 1198, 1165, 1184, 10509, 6263, 2270,
	    622, 3748, 9040, 314, 3171, 6991, 30000, 0, 0, 32 }
	},

	{ NEO, V3, DEFAULT_TPLCD, GOLD,
	  { 7841, 1321, 950, 895, 848, 1000, 978, 1000, 218, 87, 83,
	    7628, 12020, 5516, 252, 3171, 6991, 5000, 200, 1, 46 }
	},
	{ NEO, V3, DEFAULT_TPLCD, BLACK,
	  { 7107, 1171, 1302, 1294, 1310, 1000, 964, 1000, 1783, 613, 593,
	    5841, 10446, 4140, 407, 3761, 6000, 4000, 250, 1, 53 }
	},
	{ NEO, V3, DEFAULT_TPLCD, BLACK2,
	  { 7107, 1171, 1302, 1294, 1310, 1000, 964, 1000, 1783, 613, 593,
	    5841, 10446, 4140, 407, 3761, 6000, 4000, 250, 1, 53 }
	},
	{ NEO, V3, DEFAULT_TPLCD, BROWN,
	  { 12422, 940, 1294, 1319, 1295, 1000, 882, 1000, 968, 352, 330,
	    6600, 9194, 3186, 348, 3304, 6936, 4000, 300, 1, 35 }
	},
	{ NEO, V3, DEFAULT_TPLCD, BLUE,
	  { 12755, 1579, 4214, 4396, 4027, 1007, 1047, 1007, 1416, 496, 458,
	    2181, 3071, 755, 130, 3304, 6936, 4000, 300, 1, 24 }
	},
	{ NEO, V3, DEFAULT_TPLCD, PINK_GOLD,
	  { 12036, 1206, 2909, 2633, 2198, 1000, 936, 1000, 224, 89, 86,
	    3974, 4188, 1908, 116, 3171, 6991, 4000, 300, 1, 32 }
	},
	{ NEO, V3_A, DEFAULT_TPLCD, BLACK,
	  { 13952, 127, 1485, 1452, 1456, 1000, 758, 1000, 1256, 440, 410,
	    6014, 9277, 3152, 373, 3827, 6000, 4000, 250, 1, 41 }
	},
	{ NEO, V3_A, DEFAULT_TPLCD, BLACK2,
	  { 13952, 127, 1485, 1452, 1456, 1000, 758, 1000, 1256, 440, 410,
	    6014, 9277, 3152, 373, 3827, 6000, 4000, 250, 1, 41 }
	},
	{ NEO, V3_A, DEFAULT_TPLCD, GRAY,
	  { 13952, 127, 1485, 1452, 1456, 1000, 758, 1000, 1256, 440, 410,
	    6014, 9277, 3152, 373, 3827, 6000, 4000, 250, 1, 41 }
	},
	{ NEO, V3_A, DEFAULT_TPLCD, WHITE,
	  { 13952, 127, 1485, 1452, 1456, 1000, 758, 1000, 1256, 440, 410,
	    6014, 9277, 3152, 373, 3827, 6000, 4000, 250, 1, 41 }
	},
	{ NEO, V4, DEFAULT_TPLCD, WHITE,
	  { 12193, 289, 1495, 1440, 1419, 1001, 769, 1001, 1490, 507, 499,
	    4564, 7434, 2840, 264, 3087, 7876, 4000, 250, 1, 44 }
	},
	{ NEO, V4, DEFAULT_TPLCD, BLACK,
	  { 12193, 289, 1495, 1440, 1419, 1001, 769, 1001, 1490, 507, 499,
	    4564, 7434, 2840, 264, 3087, 7876, 4000, 250, 1, 44 }
	},
	{ NEO, V4, DEFAULT_TPLCD, BLACK2,
	  { 12193, 289, 1495, 1440, 1419, 1001, 769, 1001, 1490, 507, 499,
	    4564, 7434, 2840, 264, 3087, 7876, 4000, 250, 1, 44 }
	},
	{ NEO, V4, DEFAULT_TPLCD, GRAY,
	  { 12193, 289, 1495, 1440, 1419, 1001, 769, 1001, 1490, 507, 499,
	    4564, 7434, 2840, 264, 3087, 7876, 4000, 250, 1, 44 }
	},

	/* laya als para */
	{ LAYA, V3, DEFAULT_TPLCD, BLACK,
	  { 11417, 685, -26280, -28532, -31536, 1001, 921, 1001, 396, 137, 139,
	    600, 1000, 400, 36, 3087, 7876, 4000, 250, 1, 37 }
	},
	{ LAYA, V3, DEFAULT_TPLCD, BLACK2,
	  { 11417, 685, -26280, -28532, -31536, 1001, 921, 1001, 396, 137, 139,
	    600, 1000, 400, 36, 3087, 7876, 5000, 150, 1, 37 }
	},
	{ LAYA, V3, DEFAULT_TPLCD, GRAY,
	  { 11417, 685, -26280, -28532, -31536, 1001, 921, 1001, 396, 137, 139,
	    600, 1000, 400, 36, 3087, 7876, 5000, 150, 1, 37 }
	},
	{ LAYA, V3, DEFAULT_TPLCD, WHITE,
	  { 11417, 685, -26280, -28532, -31536, 1001, 921, 1001, 396, 137, 139,
	    600, 1000, 400, 36, 3087, 7876, 5000, 150, 1, 37 }
	},

	{ LAYA, V4, DEFAULT_TPLCD, BLACK,
	  { -24261, -4228, 19779, 19042, 16942, 1165, 488, 1165, 315, 111, 114,
	    326 * 2, 467 * 2, 146 * 2, 5 * 2, 2566, 14257, 6000, 100, 1, 29 }
	},
	{ LAYA, V4, DEFAULT_TPLCD, BLACK2,
	  { -24261, -4228, 19779, 19042, 16942, 1165, 488, 1165, 315, 111, 114,
	    326 * 2, 467 * 2, 146 * 2, 5 * 2, 2566, 14257, 6000, 100, 1, 29 }
	},
	{ LAYA, V4, DEFAULT_TPLCD, GRAY,
	  { -24261, -4228, 19779, 19042, 16942, 1165, 488, 1165, 315, 111, 114,
	    326 * 2, 467 * 2, 146 * 2, 5 * 2, 2566, 14257, 6000, 100, 1, 29 }
	},
	{ LAYA, V4, DEFAULT_TPLCD, WHITE,
	  { -24261, -4228, 19779, 19042, 16942, 1165, 488, 1165, 315, 111, 114,
	    326 * 2, 467 * 2, 146 * 2, 5 * 2, 2566, 14257, 6000, 100, 1, 29 }
	},

	{ LAYA, VN1, DEFAULT_TPLCD, BLACK,
	  { 16282, 702, 19418, 18134, 15373, 968, 1002, 968, 296, 136, 117,
	    658, 996, 246, 9, 2686, 6789, 4000, 100, 1, 24 }
	},
	{ LAYA, VN1, DEFAULT_TPLCD, BLACK2,
	  { 16282, 702, 19418, 18134, 15373, 968, 1002, 968, 296, 136, 117,
	    658, 996, 246, 9, 2686, 6789, 4000, 100, 1, 24 }
	},
	{ LAYA, VN1, DEFAULT_TPLCD, GRAY,
	  { 16282, 702, 19418, 18134, 15373, 968, 1002, 968, 296, 136, 117,
	    658, 996, 246, 9, 2686, 6789, 4000, 100, 1, 24 }
	},
	{ LAYA, VN1, DEFAULT_TPLCD, WHITE,
	  { 16282, 702, 19418, 18134, 15373, 968, 1002, 968, 296, 136, 117,
	    658, 996, 246, 9, 2686, 6789, 4000, 100, 1, 24 }
	}, /* laya als para end */

	{ ELLE, V3, DEFAULT_TPLCD, BLACK,
	  { 7498, 1677, 1680, 1625, 1582, 824, 980, 824, 242, 112, 88,
	    3405, 6263, 1955, 53, 2686, 6789, 4000, 250, 1, 42 }
	},
	{ ELLE, V3, DEFAULT_TPLCD, BLACK2,
	  { 7498, 1677, 1680, 1625, 1582, 824, 980, 824, 242, 112, 88,
	    3405, 6263, 1955, 53, 2686, 6789, 4000, 250, 1, 42 }
	},
	{ ELLE, V3, DEFAULT_TPLCD, GRAY,
	  { 7498, 1677, 1680, 1625, 1582, 824, 980, 824, 242, 112, 88,
	    3405, 6263, 1955, 53, 2686, 6789, 4000, 250, 1, 42 }
	},
	{ ELLE, V3, DEFAULT_TPLCD, WHITE,
	  { 7498, 1677, 1680, 1625, 1582, 824, 980, 824, 242, 112, 88,
	    3405, 6263, 1955, 53, 2686, 6789, 4000, 250, 1, 42 }
	}, /* elle als para end */

	{ VOGUE, V3, DEFAULT_TPLCD, BLACK,
	  { 7498, 1677, 1680, 1625, 1582, 824, 980, 824, 242, 112, 88,
	    3405, 6263, 1955, 53, 2686, 6789, 4000, 250, 1, 42 }
	},
	{ VOGUE, V3, DEFAULT_TPLCD, BLACK2,
	  { 7498, 1677, 1680, 1625, 1582, 824, 980, 824, 242, 112, 88,
	    3405, 6263, 1955, 53, 2686, 6789, 4000, 250, 1, 42 }
	},
	{ VOGUE, V3, DEFAULT_TPLCD, GRAY,
	  { 7498, 1677, 1680, 1625, 1582, 824, 980, 824, 242, 112, 88,
	    3405, 6263, 1955, 53, 2686, 6789, 4000, 250, 1, 42 }
	},
	{ VOGUE, V3, DEFAULT_TPLCD, WHITE,
	  { 7498, 1677, 1680, 1625, 1582, 824, 980, 824, 242, 112, 88,
	    3405, 6263, 1955, 53, 2686, 6789, 4000, 250, 1, 42 }
	}, /* vogue als para end */

	{ VRD, V3, DEFAULT_TPLCD, WHITE,
	  { 6812, 1740, 1550, 1463, 1536, 864, 994, 864, 395, 152, 149,
	    5591, 8854, 3388, 266, 3811, 5867, 7000, 100, 1, 57 }
	},
	{ VRD, V3, DEFAULT_TPLCD, BLACK,
	  { 12576, 559, 1194, 952, 883, 963, 997, 1284, 8, 5, 5,
	    4127, 5963, 1887, 224, 1576, 6289, 7000, 100, 1, 36 }
	},
	{ SCM, V3, DEFAULT_TPLCD, WHITE,
	  { 7208, 1337, 1865, 1796, 1813, 953, 1000, 859, 535, 244, 85,
	    2876, 5055, 1785, 99, 2618, 5810, 30000, 0, 1, 38 }
	},
	{ SCM, V3, DEFAULT_TPLCD, BLACK,
	  { 10024, 1165, 2302, 1531, 1704, 927, 1000, 792, 591, 269, 93,
	    1716, 2664, 782, 56, 1393, 5733, 30000, 0, 1, 38 }
	},
	{ BAH3, V3, DEFAULT_TPLCD, WHITE,
	  { 7973, 1674, 876, 888, 939, 984, 1014, 984, 13, 4, 4,
	    10319, 11954, 5747, 269, 6192, 5351, 30000, 0, 1, 48 }
	},
	{ BAH3, V3, DEFAULT_TPLCD, BLACK,
	  { 11527, 1614, 3141, 3346, 3194, 968, 1015, 968, 14, 5, 5,
	    4227, 4602, 1644, 123, 2942, 5063, 30000, 0, 1, 34 }
	},
};

apds9999_als_para_table apds9999_als_para_diff_tp_color_table[] = {
	{ OTHER, OTHER, DEFAULT_TPLCD, OTHER,
	  { 12193, 289, 12193, 289, 1495, 1440, 1419, 1001, 769, 1001, 1490,
	    507, 499, 1, 44, 100, 0, 0, 0, 0, 0, 0, 2000, 1000 }
	},
	{ HIMA, V3, DEFAULT_TPLCD, BLACK,
	  { 12193, 289, 12193, 289, 1495, 1440, 1419, 1001, 769, 1001, 1490,
	    507, 499, 1, 44, 100, 4564, 7434, 2840, 264, 3087, 7876, 4000, 250 }
	},
};

apds9251_als_para_table *als_get_apds9251_table_by_id(uint32_t id)
{
	if (id >= ARRAY_SIZE(apds_als_para_diff_tp_color_table))
		return NULL;
	return &(apds_als_para_diff_tp_color_table[id]);
}

apds9251_als_para_table *als_get_apds9251_first_table(void)
{
	return &(apds_als_para_diff_tp_color_table[0]);
}

uint32_t als_get_apds9251_table_count(void)
{
	return ARRAY_SIZE(apds_als_para_diff_tp_color_table);
}

apds9999_als_para_table *als_get_apds9999_table_by_id(uint32_t id)
{
	if (id >= ARRAY_SIZE(apds9999_als_para_diff_tp_color_table))
		return NULL;
	return &(apds9999_als_para_diff_tp_color_table[id]);
}

apds9999_als_para_table *als_get_apds9999_first_table(void)
{
	return &(apds9999_als_para_diff_tp_color_table[0]);
}

uint32_t als_get_apds9999_table_count(void)
{
	return ARRAY_SIZE(apds9999_als_para_diff_tp_color_table);
}
